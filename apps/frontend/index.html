
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI í‘¸ë“œ ë Œì¦ˆ (ê³ ë„í™” v1)</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2em auto; padding: 0 1em; }
        img { max-width: 100%; height: auto; margin-top: 1em; border: 1px solid #ddd; }
        #loading { display: none; color: #888; }
        
        /* â¬‡ï¸ --- ìŠ¤íƒ€ì¼ ì¶”ê°€ --- â¬‡ï¸ */
        #result-wrapper { display: flex; flex-wrap: wrap; gap: 1.5em; margin-top: 1.5em; }
        #gemini-result { flex: 1; min-width: 300px; padding: 1em; border: 1px solid #ccc; background: #f9f9f9; white-space: pre-wrap; }
        #imagen-result-wrapper { flex: 1; min-width: 200px; }
        #imagen-generated-img { display: none; } /* ì²˜ìŒì—” ìˆ¨ê¹€ */
        /* â¬†ï¸ --- ìŠ¤íƒ€ì¼ ì¶”ê°€ --- â¬†ï¸ */
    </style>
</head>
<body>
    <h1>ğŸ“¸ AI í‘¸ë“œ ë Œì¦ˆ (Gemini + Imagen)</h1>
    <p>ë¶„ì„í•˜ê³  ì‹¶ì€ ìŒì‹ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
    
    <form id="upload-form">
        <input type="file" id="file-input" accept="image/*" required>
        <button type="submit">ë¶„ì„í•˜ê¸°</button>
    </form>
    
    <p id="loading">AIê°€ ì—´ì‹¬íˆ ë¶„ì„í•˜ê³ , ê·¸ë¦¼ë„ ê·¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤... ğŸ¨</p>
    
    <div id="result-wrapper">
        <div id="gemini-result">
            <h3>Gemini ë¶„ì„ ê²°ê³¼:</h3>
            <p id="gemini-text">ì•„ì§ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        
        <div id="imagen-result-wrapper">
            <h3>Imagen ì¶”ì²œ ì´ë¯¸ì§€:</h3>
            <img id="imagen-generated-img" src="" alt="AIê°€ ìƒì„±í•œ ì¶”ì²œ ì‹ë‹¨ ì´ë¯¸ì§€" />
            <p id="imagen-text">ì•„ì§ ìƒì„±ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        </div>
    
    <h3>(ì›ë³¸ ì—…ë¡œë“œ ì´ë¯¸ì§€)</h3>
    <img id="preview" src="" alt="ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" style="display: none;" />


    <script>
        const form = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const loadingEl = document.getElementById('loading');
        
        // â¬‡ï¸ --- JS ìš”ì†Œ ë³€ê²½ --- â¬‡ï¸
        const geminiTextEl = document.getElementById('gemini-text');
        const imagenImgEl = document.getElementById('imagen-generated-img');
        const imagenTextEl = document.getElementById('imagen-text');
        const previewEl = document.getElementById('preview');
        // â¬†ï¸ --- JS ìš”ì†Œ ë³€ê²½ --- â¬†ï¸

        const BACKEND_URL = 'http://127.0.0.1:5000/analyze'; 

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); 
            if (!fileInput.files || fileInput.files.length === 0) {
                alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }
            const file = fileInput.files[0];
            
            previewEl.src = URL.createObjectURL(file);
            previewEl.style.display = 'block';
            loadingEl.style.display = 'block';
            geminiTextEl.innerHTML = "ë¶„ì„ ì¤‘...";
            imagenTextEl.innerHTML = "ìƒì„± ì¤‘...";
            imagenImgEl.style.display = 'none';

            const formData = new FormData();
            formData.append('image_file', file);

            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    body: formData, 
                });

                if (!response.ok) {
                    const errData = await response.json();
                    throw new Error(errData.error || `HTTP ì—ëŸ¬! ìƒíƒœ: ${response.status}`);
                }

                const data = await response.json();
                
                // â¬‡ï¸ --- JS ê²°ê³¼ ì²˜ë¦¬ ê³ ë„í™” --- â¬‡ï¸
                
                // 1. Gemini ê²°ê³¼ í‘œì‹œ
                geminiTextEl.innerHTML = data.analysis;

                // 2. Imagen ê²°ê³¼ í‘œì‹œ
                if (data.new_image_url) {
                    imagenImgEl.src = data.new_image_url; // Base64 ì´ë¯¸ì§€ ë°ì´í„° URL
                    imagenImgEl.style.display = 'block';
                    imagenTextEl.style.display = 'none'; // "ì´ë¯¸ì§€ ì—†ìŒ" í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
                } else {
                    imagenTextEl.innerHTML = "ì¶”ì²œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
                    imagenTextEl.style.display = 'block';
                }
                // â¬†ï¸ --- JS ê²°ê³¼ ì²˜ë¦¬ ê³ ë„í™” --- â¬†ï¸

            } catch (error) {
                console.error("ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                geminiTextEl.innerHTML = `<p style="color: red;">ì˜¤ë¥˜ ë°œìƒ: ${error.message}</p>`;
                imagenTextEl.innerHTML = "";
            } finally {
                loadingEl.style.display = 'none';
            }
        });
    </script>
</body>
</html>